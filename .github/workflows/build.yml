name: Build

on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - '**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Detect project type and run build/tests
        shell: bash
        run: |
          # Node
          if [ -f package.json ]; then
            echo "Detected Node project"
            npm ci
            if npm run | grep -q "test"; then
              npm test
            else
              echo "No npm test script found; build will exit with success"
            fi
            exit $?
          fi

          # Maven (Java)
          if [ -f pom.xml ]; then
            echo "Detected Maven project"
            mvn -B test
            exit $?
          fi

          # Gradle (Java/Kotlin)
          if [ -f build.gradle ] || [ -f build.gradle.kts ]; then
            echo "Detected Gradle project"
            ./gradlew build
            exit $?
          fi

          # Make
          if [ -f Makefile ]; then
            echo "Detected Makefile"
            make build || make
            exit $?
          fi

          echo "No recognized build file (package.json, pom.xml, build.gradle, Makefile)."
          echo "Add a custom build step to .github/workflows/build.yml for your project."
          exit 1